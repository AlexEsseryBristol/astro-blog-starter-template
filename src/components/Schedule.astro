---
import type { ScheduleDay } from "../types/schedule";

type Props = {
  days: ScheduleDay[];
  sort?: boolean;
};

const { days, sort = true } = Astro.props as Props;

const sortedDays = sort
  ? days.map((d) => ({
      ...d,
      items: [...d.items].sort((a, b) => a.start.localeCompare(b.start)),
    }))
  : days;
---

<section class="schedule" aria-label="Event schedule">
  {sortedDays.map((day) => (
    <div class="day">
      <h2 class="day-title">{day.dateLabel}</h2>

      <div class="table-wrap" role="region" aria-label={`Schedule for ${day.dateLabel}`}>
        <table class="schedule-table">
          <thead>
            <tr>
              <th class="col-time">Time</th>
              <th>Session</th>
              <th class="col-location">Location</th>
            </tr>
          </thead>

          <tbody>
            {day.items.map((item) => (
              <tr>
                <td class="time">
                  <span class="t">{item.start}</span>
                  {item.end ? <span class="dash">–</span> : null}
                  {item.end ? <span class="t">{item.end}</span> : null}
                </td>

                <td class="session">
                  <div class="session-top">
                    <div class="session-head">
                      <div class="session-left">
                        <div class="title-row">
                          <span class="title">{item.title}</span>
                          {item.type ? (
                            <span class={`pill pill--${item.type.toLowerCase()}`}>{item.type}</span>
                          ) : null}
                        </div>

                        {item.speakers ? <div class="speakers">{item.speakers}</div> : null}
                      </div>

                      {item.companyLogo ? (
                        <div class="logo-slot">
                          {item.companyLogo.url ? (
                            <a href={item.companyLogo.url} target="_blank" rel="noopener noreferrer">
                              <img
                                class="company-logo"
                                src={item.companyLogo.src}
                                alt={item.companyLogo.alt}
                                loading="lazy"
                              />
                            </a>
                          ) : (
                            <img
                              class="company-logo"
                              src={item.companyLogo.src}
                              alt={item.companyLogo.alt}
                              loading="lazy"
                            />
                          )}
                        </div>
                      ) : null}
                    </div>

                    {item.description ? <div class="desc">{item.description}</div> : null}

                    {item.links?.length ? (
                      <div class="links">
                        {item.links.map((l) => (
                          <a class="link" href={l.href}>{l.label}</a>
                        ))}
                      </div>
                    ) : null}
                  </div>
                </td>

                <td class="location">{item.location ?? "—"}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      <div class="cards" aria-label={`Schedule cards for ${day.dateLabel}`}>
        {day.items.map((item) => (
          <article class="card">
            <div class="card-head">
              <div class="card-time">
                <span class="t">{item.start}</span>
                {item.end ? <span class="dash">–</span> : null}
                {item.end ? <span class="t">{item.end}</span> : null}
              </div>

              {item.type ? (
                <span class={`pill pill--${item.type.toLowerCase()}`}>{item.type}</span>
              ) : null}
            </div>

            <div class="card-top">
              <div class="card-top-left">
                <div class="card-title">{item.title}</div>
                {item.speakers ? <div class="speakers">{item.speakers}</div> : null}
              </div>

              {item.companyLogo ? (
                <div class="logo-slot">
                  {item.companyLogo.url ? (
                    <a href={item.companyLogo.url} target="_blank" rel="noopener noreferrer">
                      <img
                        class="company-logo"
                        src={item.companyLogo.src}
                        alt={item.companyLogo.alt}
                        loading="lazy"
                      />
                    </a>
                  ) : (
                    <img
                      class="company-logo"
                      src={item.companyLogo.src}
                      alt={item.companyLogo.alt}
                      loading="lazy"
                    />
                  )}
                </div>
              ) : null}
            </div>

            {item.location ? <div class="card-meta"><b>Location:</b> {item.location}</div> : null}
            {item.description ? <div class="card-desc">{item.description}</div> : null}

            {item.links?.length ? (
              <div class="links">
                {item.links.map((l) => (
                  <a class="link" href={l.href}>{l.label}</a>
                ))}
              </div>
            ) : null}
          </article>
        ))}
      </div>
    </div>
  ))}
</section>

<style>
  .schedule {
    --schedule-border: rgba(255, 255, 255, 0.2);
    --schedule-row-border: rgba(255, 255, 255, 0.15);
    --schedule-pill-bg: rgba(255, 255, 255, 0.12);
    --schedule-link-bg: rgba(255, 255, 255, 0.1);
    --schedule-link-hover: rgba(255, 255, 255, 0.2);
    
    display: grid;
    gap: 3rem;
    text-align: left;
    color: white;
  }

  .day {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .day-title {
    margin: 0;
    font-size: 1.75rem;
    font-weight: 800;
    text-align: left;
    letter-spacing: -0.02em;
  }

  /* --- DESKTOP TABLE STYLES --- */
  .table-wrap {
    overflow: hidden;
    border-radius: 16px;
    background: rgba(0, 0, 0, 0.1);
    border: 1px solid var(--schedule-border);
  }

  .schedule-table {
    width: 100%;
    border-collapse: collapse;
  }

  .schedule-table th {
    background: rgba(0, 0, 0, 0.15);
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.1em;
    padding: 1rem;
    opacity: 0.8;
  }

  .schedule-table td {
    padding: 1.5rem 1rem;
    border-bottom: 1px solid var(--schedule-row-border);
    vertical-align: top;
  }

  .col-time { width: 160px; }
  .col-location { width: 200px; }

  .time { font-weight: 700; font-size: 1rem; }
  .t { font-variant-numeric: tabular-nums; }
  .dash { margin: 0 0.2rem; opacity: 0.6; }

  .session-head {
    display: flex;
    justify-content: space-between;
    gap: 1rem;
  }

  .title-row {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.25rem;
  }

  .title { font-size: 1.15rem; font-weight: 800; line-height: 1.2; }
  .speakers { font-weight: 600; font-size: 1rem; color: rgba(255,255,255,0.9); margin-top: 0.25rem; }
  .desc { margin-top: 0.75rem; line-height: 1.5; font-size: 0.95rem; opacity: 0.85; max-width: 65ch; }

  .company-logo {
    display: block;
    margin: 0;
    padding: 0;
    height: 80px;
    width: auto;
    max-width: 160px;
    object-fit: contain;
  }

  .pill {
    padding: 0.25rem 0.6rem;
    border-radius: 6px;
    font-size: 0.7rem;
    font-weight: 800;
    text-transform: uppercase;
    background: var(--schedule-pill-bg);
    border: 1px solid rgba(255,255,255,0.1);
  }

  .links { display: flex; gap: 0.5rem; margin-top: 1rem; }
  .link {
    padding: 0.4rem 0.8rem;
    background: var(--schedule-link-bg);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px;
    font-size: 0.85rem;
    font-weight: 600;
    text-decoration: none;
    color: white;
    transition: background 0.2s ease;
  }
  .link:hover { background: var(--schedule-link-hover); }

  /* --- MOBILE CARD STYLES --- */
  .cards { display: none; }

  @media (hover: none) {
    .table-wrap { display: none; }
    .cards { display: flex; flex-direction: column; gap: 1rem; }
    
    .day-title { font-size: 1.5rem; }

    .card {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid var(--schedule-border);
      border-radius: 16px;
      padding: 1.25rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .card-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .card-time {
      font-weight: 800;
      font-size: 1rem;
      background: rgba(0,0,0,0.2);
      padding: 0.2rem 0.6rem;
      border-radius: 6px;
    }

    .card-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 1rem;
    }

    .card-title { font-size: 1.25rem; font-weight: 800; line-height: 1.2; }
    .card-meta { font-size: 0.9rem; font-weight: 600; opacity: 0.9; }
    .card-desc { font-size: 0.95rem; line-height: 1.4; opacity: 0.8; }
    
    .company-logo { display: none; }
  }
</style>