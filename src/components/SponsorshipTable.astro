---
import type { Benefit, Tier } from "../types/sponsorship";

type Props = {
  title?: string;
  tiers?: Tier[];
  benefits?: Benefit[];
};

const {
  title = "Sponsorship Tiers",
  tiers: tiersProp,
  benefits: benefitsProp,
} = Astro.props as Props;

const tiers: Tier[] =
  tiersProp ?? [
    { name: "Silver (£250)" },
    { name: "Gold (£500)" },
    { name: "Platinum (£1000)" },
  ];

const benefits: Benefit[] =
  benefitsProp ?? [
    { label: "Advertisement in brochure", tiers: ["Half Page", "Full Page", "Double Page"] },
    {
      label: "Stall in exhibition room, opportunity to be chosen to give a talk or speak on a panel",
      tiers: [true, true, true],
    },
    { label: "Company description in exhibitors list in brochure", tiers: [true, true, true] },
    { label: "Logo on event website, on event signage, and in brochure", tiers: [true, true, true] },
    { label: "Guaranteed talk", tiers: [false, true, true] },
    { label: "Guaranteed panel placement", tiers: [false, false, true] },
    { label: "Choice of stall location in exhibition room", tiers: [false, false, true] },
    {
      label:
        "Sponsored material displayed at registration table, sponsor slide displayed on screen in presentation room between talks and during breaks",
      tiers: [false, false, true],
    },
  ];

// Ensure each benefit has exactly N tier cells.
// Missing values become false.
const colCount = tiers.length;
const normBenefits = benefits.map((b) => ({
  ...b,
  tiers: Array.from({ length: colCount }, (_, i) => {
    const v = b.tiers?.[i];
    if (typeof v === "string") return v;
    return Boolean(v);
  }),
}));
---

<section class="sponsorship-grid" aria-label="Sponsorship tiers comparison">
  <header class="sponsorship-header">
    <h3 class="sponsorship-title">{title}</h3>
  </header>

  <div class="sponsorship-card">
    <div class="sponsorship-table-wrap">
      <table class="sponsorship-table">
        <thead>
          <tr>
            <th class="benefit-col">Benefit</th>
            {tiers.map((t) => (
              <th class:list={["tier-col", t.highlight && "tier-highlight"]}>
                {t.name}
              </th>
            ))}
          </tr>
        </thead>

        <tbody>
          {normBenefits.map((b) => (
            <tr>
              <td class="benefit-cell">{b.label}</td>
              {b.tiers.map((cell, idx) => (
                <td class:list={["tier-cell", tiers[idx]?.highlight && "tier-highlight"]}>
                  {typeof cell === "string" ? (
                    <span class="tier-text">{cell}</span>
                  ) : (
                    cell && <span class="tick" aria-label="Included">✓</span>
                  )}
                </td>
              ))}
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  </div>
</section>

<style>
  .sponsorship-grid {
    display: grid;
    gap: 1rem;
  }

  .sponsorship-header {
    display: grid;
    gap: 0.25rem;
  }

  .sponsorship-title {
    font-size: 1.35rem;
    line-height: 1.2;
    text-align: center;
  }

  .sponsorship-card {
    padding: 1rem;
    border-radius: 14px;
    background: #00bcae;
    border: 4px solid rgba(255, 255, 255, 0.42);
  }

  .sponsorship-table-wrap {
    overflow-x: auto;
  }

  .sponsorship-table {
    width: 100%;
    border-collapse: collapse;
  }

  .sponsorship-table th,
  .sponsorship-table td {
    padding: 0.9rem 1rem;
    border: 2px solid rgba(255, 255, 255, 0.28);
    text-align: center;
    vertical-align: middle;
  }

  .sponsorship-table thead th {
    background: rgba(255, 255, 255, 0.18);
    font-weight: 750;
  }

  .benefit-col,
  .benefit-cell {
    text-align: left;
  }

  .benefit-cell {
    font-weight: 600;
    line-height: 1.25;
  }

  .tier-col {
    width: 18%;
  }

  .tier-cell {
    height: 2.6rem;
  }

  .tier-highlight {
    background: rgba(255, 255, 255, 0.18);
  }

  .tick {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 1.8rem;
    height: 1.8rem;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.18);
    border: 1px solid rgba(255, 255, 255, 0.22);
    font-size: clamp(0.75rem, 1vw, 1.1rem);
    font-weight: 850;
    line-height: 1;
  }

  .tier-text {
    font-weight: 600;
    font-size: clamp(0.75rem, 1vw, 1.2rem);
  }

  @media (max-width: 600px) {
    .sponsorship-card {
      padding: 0.9rem;
    }

    .sponsorship-table {
    }

    .sponsorship-table th,
    .sponsorship-table td {
      padding: 0.75rem 0.75rem;
      font-size: clamp(0.75rem, 1vw, 1rem);
    }
  }
</style>