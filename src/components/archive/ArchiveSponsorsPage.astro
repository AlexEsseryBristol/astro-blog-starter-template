---
// src/components/archive/ArchivesponsPage.astro
import BaseHead from "../BaseHead.astro";
import Header from "../Header.astro";
import Footer from "../Footer.astro";
import LogoGrid from "../ui/LogoGrid.astro";
import Affiliations from "../site/Affiliations.astro";
import BackLink from "../ui/BackLink.astro";
import TicketBanner from '../site/TicketBanner.astro';
import ScrollButton from "../ui/ScrollButton.astro";
import spons2024 from "../../content/attending/2024spons.json";
import spons2025 from "../../content/attending/2025spons.json";
import attending2024 from "../../content/attending/2024attending.json";
import attending2025 from "../../content/attending/2025attending.json";

import {
  buildAttendingItems,
  type AttendingMetaMap,
} from "../../lib/spons";

type Props = { year: "2024" | "2025" };
const { year } = Astro.props as Props;

const sponsMeta = (year === "2024" ? spons2024 : spons2025) as AttendingMetaMap;
const attendingMeta = (year === "2024" ? attending2024 : attending2025) as AttendingMetaMap;

// Vite requires static glob strings.
const sponModules2024 = import.meta.glob("../../assets/2024/spons/*.{avif,webp,png,jpg,jpeg,svg}", {
  eager: true,
  import: "default",
});
const sponModules2025 = import.meta.glob("../../assets/2025/spons/*.{avif,webp,png,jpg,jpeg,svg}", {
  eager: true,
  import: "default",
});
const partnerModules2024 = import.meta.glob("../../assets/2024/partners/*.{avif,webp,png,jpg,jpeg,svg}", {
  eager: true,
  import: "default",
});
const partnerModules2025 = import.meta.glob("../../assets/2025/partners/*.{avif,webp,png,jpg,jpeg,svg}", {
  eager: true,
  import: "default",
});

const attendingModules2024 = import.meta.glob("../../assets/2024/attending/*.{avif,webp,png,jpg,jpeg,svg}", {
  eager: true,
  import: "default",
});
const attendingModules2025 = import.meta.glob("../../assets/2025/attending/*.{avif,webp,png,jpg,jpeg,svg}", {
  eager: true,
  import: "default",
});

const sponModules = year === "2024" ? sponModules2024 : sponModules2025;
const attendingModules = year === "2024" ? attendingModules2024 : attendingModules2025;
const partnerModules = year === "2024" ? partnerModules2024 : partnerModules2025;

const sponItems = buildAttendingItems(sponModules, sponsMeta);
const exhibitors = buildAttendingItems(attendingModules, attendingMeta);
const partnerItems = buildAttendingItems(partnerModules, sponsMeta);

const spons = [...sponItems, ...partnerItems];

const pageTitle = `CiQ ${year} Sponsors & Attending Companies`;
const pageDesc = `Archive of CiQ ${year} sponsors and attending companies.`;
const backHref = `/archive/${year}`;
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={pageTitle} description={pageDesc} />
    <link rel="icon" type="image/png" href="/ciq_logo_small_scaled_rounded.png" />
  </head>

  <body>
    <TicketBanner />
    <Header />
    <ScrollButton/>
    <section class="topbar">
        <BackLink defaultHref={backHref} defaultLabel={`â† Back to CiQ ${year} Archive`} />
    </section>

    <section class="spons">
      <div class="inner">
        <LogoGrid title={`CiQ ${year} Sponsors`} ariaLabel={`CiQ ${year} spons`} items={spons} />
      </div>
    </section>

    <section class="exhibitors">
      <div class="inner">
        <LogoGrid title={`CiQ ${year} Exhibitors`} ariaLabel={`CiQ ${year} exhibitors`} items={exhibitors} />
      </div>
    </section>

    <Affiliations />

    <Footer />
  </body>
</html>

<style>
  .topbar {
    background-color: hsl(192, 100%, 15%);
    padding: 1rem 1.5rem;
  }
  @media (max-width: 768px) {
    .topbar {
      display: none !important;
    }
  }
  .spons {
    background-color: #a0bec6ff;
    padding: 2rem 1.5rem;
  }
  .exhibitors {
    background-color: #00bcae;
    padding: 2rem 1.5rem;
  }
  .inner {
    max-width: 900px;
    margin: 0 auto;
  }
</style>
