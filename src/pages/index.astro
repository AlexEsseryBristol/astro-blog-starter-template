---
import SiteLayout from "../layouts/SiteLayout.astro";
import Section from "../components/ui/Section.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";
import { Image } from "astro:assets";

import Logo from "../assets/logo/QECDTlogo.webp";
import bg from "../assets/background/bg.webp";

import sponsors2025 from "../content/attending/2025sponsors.json";
import LogoGrid from "../components/ui/LogoGrid.astro";
import { buildAttendingItems, type AttendingMetaMap } from "../lib/sponsor-items";

const previousSponsorsMeta = sponsors2025 as AttendingMetaMap;

const previousSponsorModules = import.meta.glob("../assets/2025/sponsors/*.{avif,webp,png,jpg,jpeg,svg}", {
  eager: true,
  import: "default",
});

const previousPartnerModules = import.meta.glob("../assets/2025/partners/*.{avif,webp,png,jpg,jpeg,svg}", {
  eager: true,
  import: "default",
});

const previousSponsors = buildAttendingItems(previousSponsorModules, previousSponsorsMeta);
const previousPartners = buildAttendingItems(previousPartnerModules, previousSponsorsMeta);

const sponsors = [...previousSponsors, ...previousPartners];

const heroBackground = `linear-gradient(rgba(0,0,0,0.45), rgba(0,0,0,0.45)), url(${bg.src})`;

const heroSectionStyle = `
  background-image: ${heroBackground};
  background-size: cover;
  background-position: center;
  height: calc(100dvh - 96px); /* initial fallback */
  display: flex;
  flex-direction: column;
  justify-content: center;
  position: relative; /* for chevron absolute */
  overflow: hidden;
`;

const heroInnerStyle = `
  width: 100%;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
`;
---

<SiteLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>

  <!-- Hero Section -->
  <Section
    as="section"
    padding="0"
    maxWidth="100%"
    style={heroSectionStyle}
    innerStyle={heroInnerStyle}
    className="hero-section"
    innerClassName="hero-inner"
  >
    <div class="hero-content">
      <h1 class="title">Careers in Quantum</h1>
      <h4>A student-led quantum careers fair</h4>
      <p>Organised by the Quantum Engineering Centre for Doctoral Training</p>
      <p>ðŸ“… 5 March 2026, 9am to 5pm</p>
      <p>ðŸ“Œ Richmond Building, Queen's Road, Bristol, BS8 1LN</p>
      <p class="partner-line">
        <span>In partnership with</span>
        <a href="/" class="logo-link">
          <Image src={Logo} alt="QECDT logo" class="logo" />
        </a>
      </p>
    </div>
  </Section>

  <!-- Fixed scroll button (outside Section, at body level) -->
  <button class="alert" id="scroll-button">
    <i class="fa-solid fa-angle-down" id="scroll-icon"></i>
  </button>

  <script src="https://kit.fontawesome.com/9bb5cd2a12.js" crossorigin="anonymous"></script>

  <script>
    // Wait for DOM to be fully loaded
    window.addEventListener('load', () => {
      const button = document.getElementById('scroll-button');
      const target = document.getElementById('about');
      const hero = document.querySelector('.hero-section');

      if (!button) {
        console.error('Scroll button not found');
        return;
      }

      if (!target) {
        console.error('Target about section not found');
        return;
      }

      let isScrolledPastThreshold = false;
      const icon = button.querySelector('#scroll-icon');

      function smoothScroll(distance, duration = 500) {
        const start = window.scrollY;
        const end = start + distance;
        const startTime = performance.now();

        function animate(now) {
          const elapsed = now - startTime;
          const t = Math.min(elapsed / duration, 1);
          const eased = t;
          window.scrollTo(0, start + (end - start) * eased);
          if (t < 1) requestAnimationFrame(animate);
        }

        requestAnimationFrame(animate);
      }

      function updateButtonState() {
        // Fixed scroll threshold
        const threshold = 305;

        // Only check window scroll, ignore hover transforms entirely
        const scrolled = window.scrollY > threshold;

        // Only update if the state actually changes
        if (scrolled !== isScrolledPastThreshold) {
          isScrolledPastThreshold = scrolled;

          if (scrolled) {
            // Bottom-right position
            button.classList.add('scrolled');
            if (icon) icon.className = 'fa-solid fa-angle-up';
          } else {
            // Bottom-center
            button.classList.remove('scrolled');
            if (icon) icon.className = 'fa-solid fa-angle-down';
          }
        }
      }


      // Check scroll position on scroll
      window.addEventListener('scroll', updateButtonState);
      
      // Initial check
      updateButtonState();

      // Mouse hover effects (only when not scrolled)
      button.addEventListener('mouseenter', () => {
        if (!(window.scrollY > 100)) {
          smoothScroll(200, 200);
        }
      });
      
      button.addEventListener('mouseleave', () => {
        if (!(window.scrollY > 305)) {
          smoothScroll(-200, 200);
        }
      });

      // Click handler - changes behavior based on scroll position
      button.addEventListener('click', (e) => {
        e.preventDefault();
        
        if (isScrolledPastThreshold) {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        } else {
          // Scroll to about section
          if (target) {
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }
      });
    });
  </script>

  <!-- About Section -->
  <Section
    as="section"
    background="hsl(192, 100%, 15%)"
    padding="4rem 1.5rem"
    maxWidth="900px"
    id="about"
  >
    <h2>About the Event</h2>
    <p>
      Every year <b>Careers in Quantum</b> brings together professionals from industry and academia to engage
      with students and early-stage researchers on the variety and types of careers available in the quantum
      industry.
      <br />
      We aim to introduce undergraduate students, career-minded PhD students and postdoctoral researchers to
      the opportunities within the rapidly growing quantum technology sector.
      <br />
      The event focuses around a careers fair with a breakout room for more in-depth talks and panel
      discussions.
      <br />
      This year, <b>Careers in Quantum</b> will be held from 9am to 5pm on <b>Thursday 5 March 2026</b> at
      <b> Richmond Building, Queen's Road, Bristol, BS8 1LN</b>.
    </p>
  </Section>

  <!-- Sponsorship Section -->
  <Section background="#87a5ad" padding="4rem 1.5rem" maxWidth="900px">
    <h2>Sponsorship</h2>
    <p>
      Do you work in quantum technologies?
      <br />
      Are you interested in connecting with potential future employees from a broad range of disciplines?
      <br />
      Do you want to showcase your company?
      <br />
      Explore <a href="/sponsorship">Sponsorship Benefits</a> to find out more about how you can make an
      impression on the next generation of quantum researchers, and <a href="/contact">Contact Us</a> for
      further information.
    </p>
  </Section>

  <!-- Previous Sponsors -->
  <Section background="#00bcae" padding="4rem 1.5rem" maxWidth="900px">
    <h2>Previous Sponsors</h2>
    <LogoGrid items={sponsors} ariaLabel="Previous sponsors" />
  </Section>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      overflow-x: hidden;
    }
    *, *::before, *::after {
      box-sizing: inherit;
    }

    .hero-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 0 1.5rem;
    }

    .partner-line {
      margin-top: -0.5rem;
      display: inline-flex;
      align-items: center;
      gap: 0.8rem;
    }

    .logo-link {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
    }

    .logo { height: 100px; width: auto; display: block; }

    .title{
      font-size: 5rem;
    }

    /* Circular fixed button at bottom center */
 /* Circular fixed button */
.alert {
  position: fixed;
  bottom: 1.5rem;
  left: 50%;
  width: 3.5rem;
  height: 3.5rem;
  padding: 0;
  background-color: white;
  color: hsl(192, 100%, 15%);
  border: none;
  border-radius: 50%;
  cursor: pointer;
  font-size: 1.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  /* start at bottom-center */
  transform: translateX(-50%) translateY(0);
  transition: transform 0.5s cubic-bezier(.25,.1,.25,1),
              background-color 0.2s ease;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.25);
}

/* Hover lift */
.alert:hover {
  transform: translateX(-50%) translateY(-3px);
  background-color: #00bcae;
  color: white;
}

/* Scrolled state: move right */
.alert.scrolled {
  /* move 1.5rem away from right edge */
  transform: translateX(calc(50vw - 5rem)) translateY(0);
}

/* Hover lift when scrolled */
.alert.scrolled:hover {
  transform: translateX(calc(50vw - 5rem)) translateY(-3px);
}

/* Click feedback */
.alert:active {
  transform: translateX(-50%) translateY(-5px);
}

.alert.scrolled:active {
  transform: translateX(calc(50vw - 5rem)) translateY(-5px);
}

/* Icon rotation */
.alert i {
  transition: transform 0.5s cubic-bezier(.25,.1,.25,1);
}

  </style>

</SiteLayout>