---
import SiteLayout from "../layouts/SiteLayout.astro";
import Section from "../components/ui/Section.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";
import { Image } from "astro:assets";

import Logo from "../assets/logo/QECDTlogo.webp";
import bg from "../assets/background/bg.webp";

import sponsMeta from "../content/attending/2026spons.json";
import LogoGrid from "../components/ui/LogoGrid.astro";
import { buildAttendingItems, type AttendingMetaMap } from "../lib/spons";

const previoussponsMeta = sponsMeta as AttendingMetaMap;

const previousSponModules = import.meta.glob("../assets/2026/spons/*.{avif,webp,png,jpg,jpeg,svg}", {
  eager: true,
  import: "default",
});

const previousPartnerModules = import.meta.glob("../assets/2026/partners/*.{avif,webp,png,jpg,jpeg,svg}", {
  eager: true,
  import: "default",
});

const previousspons = buildAttendingItems(previousSponModules, previoussponsMeta);
const previousPartners = buildAttendingItems(previousPartnerModules, previoussponsMeta);

const spons = previousspons;

const heroBackground = `linear-gradient(rgba(0,0,0,0.45), rgba(0,0,0,0.45)), url(${bg.src})`;

const heroSectionStyle = `
  background-image: ${heroBackground};
  background-size: cover;
  background-position: center;
  min-height: calc(100dvh - 96px);
  display: flex;
  flex-direction: column;
  justify-content: center;
  position: relative;
  overflow: hidden;
`;

const heroInnerStyle = `
  width: 100%;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  padding-top: 2rem; 
  padding-bottom: 3rem; 
`;
---

<SiteLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>

  <Section
    as="section"
    padding="0"
    maxWidth="100%"
    style={heroSectionStyle}
    innerStyle={heroInnerStyle}
    className="hero-section"
    innerClassName="hero-inner"
  >
    <div class="hero-content">
      <h1 class="title">Careers in Quantum</h1>
      <h4>A student-led quantum careers fair</h4>
      
      <div class="hero-details">
        <p>ðŸ“… 5 March 2026, 9:30am to 6:30pm</p>
        <p>ðŸ“Œ Richmond Building, Queen's Road, Bristol, BS8 1LN</p>
      </div>

      <p class="partner-line">
        <span class="partner-text">In partnership with</span>
        <Image src={Logo} alt="QECDT Logo" aria-label="QECDT Logo"/>
      </p>
    </div>
  </Section>

  <button class="alert" id="scroll-button" aria-label="Scroll to content">
    <i class="fa-solid fa-angle-down" id="scroll-icon"></i>
  </button>

  <script src="https://kit.fontawesome.com/9bb5cd2a12.js" crossorigin="anonymous"></script>

  <script>
      window.addEventListener('load', () => {
        const button = document.getElementById('scroll-button');
        const target = document.getElementById('about');
        if (!button || !target) return;

        const icon = button.querySelector('i');
        const isTouch = window.matchMedia('(pointer: coarse)').matches;

        // Mouse-only "Nudge" behavior (restored original logic)
        if (!isTouch) {
          button.addEventListener('mouseenter', () => { if (window.scrollY < 100) window.scrollBy({ top: 150, behavior: 'smooth' }); });
          button.addEventListener('mouseleave', () => { if (window.scrollY < 305 && window.scrollY > 0) window.scrollTo({ top: 0, behavior: 'smooth' }); });
        }

        window.addEventListener('scroll', () => {
          const scrollPos = window.scrollY;
          
          if (scrollPos > 300) {
            button.classList.add('scrolled');
            if (icon) icon.className = 'fa-solid fa-angle-up';
          } else {
            button.classList.remove('scrolled');
            if (icon) icon.className = 'fa-solid fa-angle-down';
          }
        }, { passive: true });

        button.addEventListener('click', (e) => {
          e.preventDefault();
          if (window.scrollY > 300) {
            window.scrollTo({ top: 0, behavior: 'smooth' });
          } else {
            target.scrollIntoView({ behavior: 'smooth' });
          }
        });
      });
  </script>

  <Section
    as="section"
    background="hsl(192, 100%, 15%)"
    padding="2rem 1.5rem"
    maxWidth="900px"
    id="about"
  >
    <h2>About the Event</h2>
    <p>
      Every year <b>Careers in Quantum</b> brings together professionals from industry and academia to engage
      with students and early-stage researchers on the variety and types of careers available in the quantum
      industry.
      <br /><br />
      We aim to introduce undergraduate students, career-minded PhD students and postdoctoral researchers to
      the opportunities within the rapidly growing quantum technology sector.
      <br /><br />
      The event focuses around a careers fair with a breakout room for more in-depth talks and panel
      discussions.
      <br /><br />
      This year, <b>Careers in Quantum</b> will be held from 9:30am to 4:30pm on <b>Thursday 5 March 2026</b> at
      <b> Richmond Building, Queen's Road, Bristol, BS8 1LN</b>.
    </p>
  </Section>

  <Section 
    background="#87a5ad" 
    padding="2rem 1.5rem"
    maxWidth="900px"
  >
    <h2>Sponsorship</h2>
    <p>
    <ul>
      <li>Do you work in quantum technologies?</li>
      <li>Are you interested in connecting with potential future employees from a broad range of disciplines?</li>
      <li>Do you want to showcase your company?</li>
    </ul>
      Explore <a href="/sponsorship">Sponsorship Benefits</a> to find out more about how you can make an
      impression on the next generation of quantum researchers, and <a href="/contact">Contact Us</a> for
      further information.
    </ul>
    </p>
  </Section>

  <Section 
    background="#00bcae" 
    padding="2rem 1.5rem"
    maxWidth="900px"
  >
    <h2>2026 Sponsors include...</h2>
    <LogoGrid items={spons} ariaLabel="2026 spons" />
  </Section>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      overflow-x: hidden;
    }
    *, *::before, *::after {
      box-sizing: inherit;
    }

    .hero-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 0 1.5rem;
      width: 100%;
    }

    .title {
      font-size: var(--fs-hero); 
      margin-bottom: 1rem;
    }

    .hero-details p {
      margin: 0.5rem 0;
    }

    .partner-line {
      margin-top: 1.5rem;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .logo-link {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
    }

    .logo { 
      height: 100px; 
      width: auto; 
      display: block; 
      max-width: 80vw; 
      object-fit: contain;
    }

    /* --- SCROLL BUTTON (Restored Original Styles) --- */
    .alert {
      position: fixed;
      bottom: 1.5rem;
      left: 50%;
      width: 3.5rem;
      height: 3.5rem;
      padding: 0;
      background-color: white;
      color: hsl(192, 100%, 15%);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      
      /* Initial state: Hidden and Centered */
      opacity: 0;
      visibility: hidden;
      transform: translateX(-50%) translateY(20px);
      
      transition: transform 0.5s cubic-bezier(.25,.1,.25,1),
                  background-color 0.2s ease,
                  opacity 0.4s ease,
                  visibility 0.4s;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.25);
      -webkit-tap-highlight-color: transparent;
    }

    /* Shown at Top (The nudge state) */
    .alert:not(.scrolled) {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) translateY(0);
    }

    /* Scrolled State (Moves to corner) */
    .alert.scrolled {
      opacity: 1;
      visibility: visible;
      transform: translateX(calc(50vw - 5rem)) translateY(0);
    }

    /* --- HOVER INTERACTIONS --- */
    @media (hover: hover) {
      .alert:hover {
        background-color: #00bcae;
        color: white;
        transform: translateX(-50%) translateY(-3px);
      }
      .alert.scrolled:hover {
        transform: translateX(calc(50vw - 5rem)) translateY(-3px);
      }
    }

    .alert:active {
      transform: translateX(-50%) translateY(-5px);
      background-color: #e5e9f0;
    }

    .alert.scrolled:active {
      transform: translateX(calc(50vw - 5rem)) translateY(-5px);
    }

    /* Mobile adjustments */
    @media (hover: none) {
      .partner-line { flex-direction: column; gap: 0.5rem; }
      .logo { width: 180px; height: auto; }

      .alert:not(.scrolled) {
        opacity: 1;
        visibility: visible;
        transform: translateX(calc(50vw - 4rem)) translateY(0);
      }
      
      .alert {
        width: 3rem;
        height: 3rem;
        font-size: 1.25rem;
        bottom: 1rem;
        transform: translateX(calc(50vw - 4rem)) translateY(0);
      }

      .alert.scrolled {
        transform: translateX(calc(50vw - 4rem)) translateY(0);
      }

      .alert:active {
         transform: translateX(calc(50vw - 4rem)) translateY(-5);
      }
      
      .alert.scrolled:active {
        transform: translateX(calc(50vw - 4rem)) translateY(-5px);
      }
    }
  </style>
</SiteLayout>